<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Montpellier Mobilit√© - Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="sidebar">
    <div class="logo">
      <h2>MTP<span>Data</span></h2>
    </div>

    <nav>
      <a href="index.html" class="active">Vue d'ensemble</a>
      <a href="carte.html">Carte (plein √©cran)</a>
      <a href="analyse_globale.html">Analyse globale</a>
      <a href="correlation.html">Corr√©lation (parking ‚Üî station)</a>
      <a href="relais_pertinents.html">Relais pertinents</a>
    </nav>

    <div class="user-profile">
      <p>Bureau du Maire</p>
    </div>
  </div>

  <main class="content">
    <header>
      <div>
        <h1>Observatoire Mobilit√©</h1>
        <p class="subtitle">Donn√©es actualis√©es automatiquement (GitHub Actions)</p>
        <p class="subtitle" id="lastUpdate">Derni√®re mise √† jour : ‚Ä¶</p>
      </div>
      <div class="status-badge">
        <span class="dot"></span> Syst√®me Actif
      </div>
    </header>

    <section class="cards-grid">
      <!-- Corr√©lation -->
      <div class="card kpi">
        <div class="icon-box orange">üîó</div>
        <div class="kpi-info">
          <h3>Corr√©lation voiture ‚Üî v√©lo</h3>
          <p class="number" id="corrValue">‚Ä¶</p>
          <span class="trend neutral" id="corrInfo">n=‚Ä¶</span>
        </div>
      </div>

      <!-- NOUVEAU : Relais pertinents -->
      <div class="card kpi">
        <div class="icon-box green">üîÅ</div>
        <div class="kpi-info">
          <h3>Relais pertinents</h3>
          <p class="number" id="relCount">‚Ä¶</p>
          <span class="trend neutral" id="relRules">chargement‚Ä¶</span>
          <div style="margin-top:6px;">
            <a href="relais_pertinents.html" style="font-weight:700; text-decoration:none;">Voir la liste ‚Üí</a>
          </div>
        </div>
      </div>

      <!-- Carte interactive -->
      <div class="card kpi">
        <div class="icon-box purple">üó∫Ô∏è</div>
        <div class="kpi-info">
          <h3>Carte interactive</h3>
          <p class="text-stat">Folium</p>
          <span class="sub-text">Chaque point est interactif : un clic permet de consulter les donn√©es et les graphiques correspondants.</span>
        </div>
      </div>

      <!-- Analyse globale -->
      <div class="card kpi">
        <div class="icon-box blue">üìä</div>
        <div class="kpi-info">
          <h3>Analyse globale</h3>
          <p class="text-stat">Plotly</p>
          <span class="sub-text">Courbes interactives + corr√©lation</span>
        </div>
      </div>
    </section>

    <section class="main-grid">
      <div class="card graph-container">
        <div class="card-header">
          <h3>Carte Montpellier (parkings + v√©los)</h3>
        </div>

        <div class="map-wrapper">
          <iframe
            src="carte.html"
            title="Carte interactive"
            loading="lazy"
            referrerpolicy="no-referrer"
          ></iframe>
        </div>

        <div style="margin-top:12px; font-size:0.9rem; color:#636e72;">
          Information : la carte peut √™tre ouverte en plein √©cran via le menu lat√©ral.
          <br>
          Les graphiques interactifs sont accessibles depuis les fen√™tres contextuelles de la carte.
        </div>
      </div>

      <div class="card info-container">
        <div class="card-header">
          <h3>Lecture rapide</h3>
        </div>

        <div class="alert-item">
          <span class="time">Conseil</span>
          <p><strong>Pour consulter les informations :</strong> s√©lectionner un point sur la carte.</p>
        </div>

        <div class="alert-item">
          <span class="time">Lien</span>
          <p>Carte plein √©cran : <strong><a href="carte.html">carte.html</a></strong></p>
        </div>

        <div class="alert-item">
          <span class="time">Nouveau</span>
          <p>Analyse globale : <strong><a href="analyse_globale.html">analyse_globale.html</a></strong></p>
        </div>

        <div class="alert-item">
          <span class="time">Corr√©lation</span>
          <p>Choisir 1 parking + 1 station : <strong><a href="correlation.html">correlation.html</a></strong></p>
        </div>

        <div class="alert-item">
          <span class="time">Relais</span>
          <p>Meilleurs couples proches : <strong><a href="relais_pertinents.html">relais_pertinents.html</a></strong></p>
        </div>
      </div>
    </section>

  </main>

  <script>
    async function safeFetchJson(url){
      try{
        const r = await fetch(url, {cache:"no-store"});
        if(!r.ok) return null;
        return await r.json();
      }catch(e){ return null; }
    }

    function formatTs(ts){
      if(!ts) return "";
      return String(ts).replace("T"," ").replace("+01:00","").replace("+02:00","");
    }

    (async()=>{
      // Derni√®re mise √† jour
      const upd = await safeFetchJson("donnees/last_update.json");
      document.getElementById("lastUpdate").textContent = upd?.last_update
        ? ("Derni√®re mise √† jour : " + formatTs(upd.last_update))
        : "Derni√®re mise √† jour : inconnue";

      // Corr√©lation globale
      const corr = await safeFetchJson("donnees/correlation_global.json");
      const corrValue = document.getElementById("corrValue");
      const corrInfo = document.getElementById("corrInfo");

      if(corr && typeof corr.correlation === "number"){
        corrValue.textContent = corr.correlation.toFixed(3);
        corrInfo.textContent = "n=" + (corr.n_points ?? "?") + " (" + (corr.method ?? "pearson") + ")";
      }else{
        corrValue.textContent = "N/A";
        corrInfo.textContent = "pas assez de points";
      }

      // Relais pertinents (JSON)
      const rel = await safeFetchJson("donnees/relais_pertinents.json");
      const relCount = document.getElementById("relCount");
      const relRules = document.getElementById("relRules");

      if(rel && Array.isArray(rel.items)){
        relCount.textContent = String(rel.items.length);
        const d = rel.max_distance_m ?? "?";
        const p = rel.min_points ?? "?";
        relRules.textContent = "dist ‚â§ " + d + " m | points ‚â• " + p;
      }else{
        relCount.textContent = "N/A";
        relRules.textContent = "JSON manquant";
      }
    })();
  </script>
</body>
</html>




